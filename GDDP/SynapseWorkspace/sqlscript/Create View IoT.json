{
	"name": "Create View IoT",
	"properties": {
		"folder": {
			"name": "IoT"
		},
		"content": {
			"query": "--Create database GuimchaDB\n--GO\n--ALTER DATABASE GuimchaDB COLLATE LATIN1_GENERAL_100_CI_AS_SC_UTF8;\n--GO\n\nuse GuimchaDB\nGO\n\n--drop view IoTSummary\ncreate view IoTSummary as \nselect a.deviceid \n        , b.devicetype \n        , cast(b.location as varchar(128)) as location\n        , cast(b.latitude as float) as latitude\n        , cast(b.longitude as float) as  longitude\n        , a.measuretype \n        , a.unitSymbol \n        , cast(sum(measureValue) as float) as measureValueSum \n        , count(*) as count \nfrom OPENROWSET(\n    PROVIDER = 'CosmosDB',\n    CONNECTION = 'Account=playgroundeu2;Database=Volcano;',\n    OBJECT = 'IoTSignals',\n    SERVER_CREDENTIAL  = 'MyCosmosDbAccountCredential'\n    ) as a \nleft join OPENROWSET(\n        PROVIDER = 'CosmosDB',\n        CONNECTION = 'Account=playgroundeu2;Database=Volcano;',\n        OBJECT = 'IoTDeviceInfo',\n        SERVER_CREDENTIAL  = 'MyCosmosDbAccountCredential'\n        ) as b \non a.deviceid = b.deviceid \nwhere a.unitSymbol = 'RPM' \ngroup by a.deviceid, b.devicetype, b.location, b.latitude, b.longitude, a.measuretype, a.unitSymbol\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"name": "GuimchaDB",
				"type": "SqlOnDemand"
			}
		},
		"type": "SqlQuery"
	}
}